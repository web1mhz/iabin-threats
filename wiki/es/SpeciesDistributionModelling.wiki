#labels sdm,R
#sidebar TableOfContents

Documentación sobre como se hizo el modelado de distribución de las especies(SDM).

[http://code.google.com/p/iabin-threats/wiki/SpeciesDistributionModelling?wl=en http://iabin-threats.googlecode.com/svn/wiki/resources/gb.gif]
[http://code.google.com/p/iabin-threats/wiki/SpeciesDistributionModelling?wl=es http://iabin-threats.googlecode.com/svn/wiki/resources/es.gif]

<wiki:toc />

= Introducción =

Esta página pretende dar un breve resumen no técnico sobre el modelado de distribución de las especies (SDM) dentro del proyecto IABIN.

= Detalles =
== Programa ==
Todo el trabajo se realizó con:
  * R (En particular paquetes raster y snowfall)
  * MaxEnt 3.3.1
  * GRASS 6.4
  * Bash
== Preparación y organización de los datos  ==
Flujo de trabajo:
  * *Organización de los datos de especies:* Los datos de presencia de datos se dividieron a nivel de especie. Para cada especie se creó un directorio que contiene los puntos de presencia para esas especies en el archivo _info.txt_. En el archivo _info.txt_ se encuentra guardada información básica de la especie (i.e. reino, familia, genero, número de presencia de puntos). Durante el proceso de modelado los resultados para la especie se escriben en este archivo. 
  * *Obteniendo puntos de fondo:* MaxEnt requiere una muestra de fondo al azar. Para cada especie se determinó en cuales biomas(según la clasificación de wwf) se redujo la presencia de puntos. A partir de estos biomas se ha elaborado una muestra aleatoria de 10.000 para los puntos de fondo.
  * *Extracción de los valores de las variables climáticas:* Las coordenadas de todas las especies y los puntos de fondo se fusionaron. Usando maxent los valores de las 8 variables ambientales fueron extraídos.para cada especie, para cada presencia y para todos los valores de fondo se asignaron las variables ambientales apropiadas.

== Procesamiento ==
*01_main.R*: El script contiene el flujo de trabajo completo. Algunas funciones se realizan en otros scripts, para reducir el codigo. La primera parte, hasta la evaluación de los modelos Maxent, es casi exclusivamente escrito en R. La mayoría de los análisis se realiza con GRASS, por lo tanto, los scripts son para un intérprete de comandos bash. El archivo másimportante es el archivo _parameters.R_. Este archivo es creado en el inicio del proceso y contiene todos los parámetros y funciones adicionales.
 * Tarea 9: La función `write.species.csv()` se aplica a todas las especies. Extrae los puntos para todas las especies con más de 10 o más puntos de ocurrencia, crea una carpeta para las especies y almacena los puntos en la subcarpeta training. El script se guarda en *write_species_csv.R*.
 * Tarea 10-13: Esta parte del código crea los archivos SWD para la presencia de puntos y puntos de fondo y crea el script por lotes de R para correr Maxent.
  # Con la función `get.background(...)` para todas las especies de los puntos de fondo se extraen de los mismos biomas donde se encuentran los puntos de presencia. La función es guardada en *002_make_background.R*. `get.background()` puede ser paralelizado con `sfApply()` del paquete snowfall. 
  # Archivos que ahora tienen fondos, porque habia un error son movidos a la carpeta *no_bg* y no serán considerados para los próximos pasos del análisis. 
  # La función `get.full.swd(...)` se ejecuta dos veces. Una vez para los puntos de fondo y una vez para los puntos de presencia. `get.full.swd()` se encuentra en *002_get_background.R*. la funcion extrae todos los puntos unicos de presencia y ausencia. para estos puntos los valores de las capas ambientales se extraen con `get.full.swd()` basado en Maxent, y algunas herramientas de shell de Unix como awk.
 # Con la función `get.sp.swd()` los archivos generados en el último paso se dividen de nuevo y se crea un archivo SWD para cada especie para los puntos de orígenes y puntos de presencia.
 # En el siguiente ciclo para cada servidor se crea una carpeta, cada carpeta contiene para cada núcleo disponible en el servidor un archivo de R BATCH. Que se pueden iniciar con `R BATCH filename.R`. Las especies se distribuyen por igual en todos los núcleos.
 * Tarea 15: Para esta parte, R debe ser iniciado desde un grass shell. Para cada modelo las predicciones se importan a grass y las estadísticas de evaluación son extraídas y escritas en *info.txt* para cada especie. 
 * Tarea 14: Aquí se calcula un área convexa de todos los puntos de presencia. Esta área tiene un buffer de 300 km y el raster con las predicciones esta confinado al area convexa en buffer
 * Tarea 16: Se calcula la riqueza de especies de cada género. 
 * Tarea 17: Se calcula la riqueza de especies por cada tipo de especies.
 * Tarea 18: Para cada especie el área bajo cada nivel (no, baja, media, alta) de cada amenaza es calculada. Además,se calcula la fracción del área que todavía está disponible y la que ya se ha perdido.
 * Tarea 19: Para cada especie, se calcula la probabilidad media de ocurrencia dentro y fuera de las áreas protegidas. Además, para cada especie se calcula el porcentaje de área protegida.
 * Tarea 20: Para cada área protegida se calcula la media de la riqueza de especies y la media de cada amenaza.
 * Tarea 21: Para cada tipo de especies se calcula la media de la riqueza de especies y se calcula el porcentaje que está protegido.	




